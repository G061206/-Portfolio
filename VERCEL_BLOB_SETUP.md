# Vercel Blob + KV 设置指南

## 🎉 升级完成

项目已成功升级到 Vercel Blob + KV 存储方案，解决了数据持久化问题。

## 🔧 升级内容

### 1. 新增依赖
- ✅ `@vercel/blob@^2.0.0` - 文件存储
- ✅ `@vercel/kv@^1.0.1` - 数据存储

### 2. 存储架构
- **图片存储**: Vercel Blob（永久存储，全球CDN）
- **元数据存储**: Vercel KV（Redis，高性能）
- **本地开发**: 文件系统（无需额外配置）

### 3. 智能环境检测
- 自动检测运行环境
- 本地开发使用文件存储
- Vercel 部署使用 Blob + KV

## 🚀 部署配置

### 步骤1：配置 Vercel Blob

1. **访问 Vercel Dashboard**
   - 进入你的项目设置
   - 点击 "Storage" 标签
   - 添加 "Blob" 存储

2. **获取配置信息**
   ```
   BLOB_READ_WRITE_TOKEN=your_token_here
   ```

### 步骤2：配置 Vercel KV

1. **添加 KV 数据库**
   - 在 Storage 中点击 "Create Database"
   - 选择 "KV" 类型
   - 创建数据库

2. **获取连接信息**
   ```
   KV_REST_API_URL=your_kv_url
   KV_REST_API_TOKEN=your_kv_token
   ```

### 步骤3：设置环境变量

在 Vercel Dashboard 的项目设置中添加：

| 变量名 | 值 | 说明 |
|--------|-----|------|
| `BLOB_READ_WRITE_TOKEN` | [从 Blob 设置获取] | Blob 存储访问令牌 |
| `KV_REST_API_URL` | [从 KV 设置获取] | KV 数据库 URL |
| `KV_REST_API_TOKEN` | [从 KV 设置获取] | KV 数据库令牌 |

### 步骤4：重新部署

```bash
git add .
git commit -m "Upgrade to Vercel Blob + KV storage"
git push origin main
```

## 📋 功能验证清单

部署后请验证以下功能：

- [ ] 后台登录正常（密码：602160）
- [ ] 图片上传成功
- [ ] 图片显示正常（CDN URL）
- [ ] 图片删除功能
- [ ] 数据持久化（重启后数据仍在）
- [ ] 响应式设计正常

## 🎯 新功能特性

### 1. 永久存储
- ✅ 图片永久保存，不会丢失
- ✅ 元数据持久化存储
- ✅ 无需担心函数重启

### 2. 性能优化
- ✅ 全球 CDN 加速
- ✅ 自动图片优化
- ✅ 高速数据访问

### 3. 可扩展性
- ✅ 支持大量图片存储
- ✅ 高并发访问
- ✅ 自动备份和恢复

## 🔍 存储详情

### Vercel Blob 特性
- **存储类型**: 对象存储
- **访问方式**: HTTPS URL
- **CDN**: 全球分布
- **安全性**: 公共访问（图片展示用）

### Vercel KV 特性
- **数据库类型**: Redis
- **数据格式**: JSON
- **访问速度**: 毫秒级
- **容量**: 高可用

## 📊 成本信息

### Vercel Blob
- **免费额度**: 每月 5GB
- **超出费用**: $0.15/GB
- **请求费用**: 免费

### Vercel KV
- **免费额度**: 每月 30,000 请求
- **存储**: 256MB 免费
- **超出费用**: 按使用量计费

## 🛠️ 本地开发

本地开发无需配置 Vercel 服务：

```bash
# 启动本地服务器
npm run dev

# 本地使用文件存储
# 图片保存在: public/uploads/
# 数据保存在: data/photos.json
```

## 🔧 故障排除

### 问题1：上传失败
**可能原因**:
- Blob Token 未配置
- Token 权限不足

**解决方案**:
1. 检查环境变量设置
2. 确认 Token 权限为 Read+Write
3. 查看 Vercel 函数日志

### 问题2：数据读取失败
**可能原因**:
- KV 配置错误
- 网络连接问题

**解决方案**:
1. 检查 KV 配置
2. 确认数据库状态
3. 查看错误日志

### 问题3：图片显示异常
**可能原因**:
- CDN 缓存问题
- URL 格式错误

**解决方案**:
1. 等待 CDN 同步（通常几分钟）
2. 检查图片 URL 格式
3. 清除浏览器缓存

## 🔄 数据迁移

如果之前有测试数据想要保留：

1. **导出现有数据**（如果有）
2. **手动重新上传图片**
3. **验证迁移结果**

## 📈 监控和维护

### 使用情况监控
- Vercel Dashboard 查看存储使用量
- 监控请求数和错误率
- 设置用量警报

### 定期维护
- 清理不需要的图片
- 检查数据一致性
- 更新依赖包版本

## 🎊 升级完成

恭喜！你的摄影作品集现在使用了专业级的云存储方案：

- 🚀 **高性能**: 全球 CDN 加速
- 🔒 **高可靠**: 永久数据存储
- 📈 **高扩展**: 支持大量访问
- 💰 **成本优化**: 免费额度充足

现在可以放心地上传和展示你的摄影作品了！
